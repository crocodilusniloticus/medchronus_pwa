server {
    listen 80;
    server_name localhost;
    root /usr/share/nginx/html;
    index index.html;

    # Security Headers
    add_header Cross-Origin-Opener-Policy "same-origin-allow-popups" always;
    add_header Referrer-Policy "no-referrer-when-downgrade" always;

    location / {
        try_files $uri $uri/ /index.html;
        # CRITICAL: Tell browser NOT to cache the HTML entry point
        add_header Cache-Control "no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0";
    }

    # CRITICAL: Never cache the Service Worker or Manifest
    # If these are cached, the app will never know an update exists.
    location ~* (service-worker\.js|manifest\.json)$ {
        add_header Cache-Control "no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0";
        expires off;
    }

    # Assets (JS, CSS, Images)
    # Changed from 'expires 1y' to 'no-cache'.
    # 'no-cache' means "Check with server if file changed before using local copy".
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|json)$ {
        add_header Cache-Control "no-cache";
        # Keep your CORS header for assets
        add_header Cross-Origin-Opener-Policy "same-origin-allow-popups" always;
    }
}